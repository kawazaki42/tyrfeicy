# Сборочный файл.
# Требует Unix-окружения (напр. Linux, MacOS или MinGW на MS Windows).
# Использует систему сборки make.
# На обычном Паскале не запустится!
# Возможнна ручная сборка в командной строке.

# Компилятор Паскаля по умолчанию (Free Pascal)
PC = fpc

# Цель по умолчаню (программа main)
all: main

# Запуск
run: main
	@# Делает то же, что и './main', но задает путь поиска библиотек в этой папке.
	@LD_LIBRARY_PATH=".:$$LD_LIBRARY_PATH" ./$<

# Сборка программы на C.
%: %.c libmy.so
	# Искать библиотеки в `.` (в этой папке);
	# подключить библиотеку 'my'
	# $< - входной файл
	# $@ - результат сборки
	$(CC) -L. -lmy $< -o $@

# Сборка библиотеки на Паскале.
libmy.so: my.pas

lib%.so: %.pas
	$(PC) $<
